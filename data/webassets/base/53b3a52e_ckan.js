this.ckan.module('select-switch',{options:{target:'select'},initialize:function(){var _this=this;this.el.on('change',this.options.target,function(){_this.el.submit();});}});this.ckan.module('slug-preview-target',{initialize:function(){var sandbox=this.sandbox;var options=this.options;var el=this.el;sandbox.subscribe('slug-preview-created',function(preview){el.after(preview);});if(el.val()==''){sandbox.subscribe('slug-preview-modified',function(){el.off('.slug-preview');});el.on('keyup.slug-preview input.slug-preview',function(event){sandbox.publish('slug-target-changed',this.value);});}}});this.ckan.module('slug-preview-slug',function(jQuery){return{options:{prefix:'',placeholder:'<slug>'},initialize:function(){var sandbox=this.sandbox;var options=this.options;var el=this.el;var _=sandbox.translate;var slug=el.slug();var parent=slug.parents('.form-group');var preview;if(!(parent.length)){return;}
if(!parent.hasClass('error')){preview=parent.slugPreview({prefix:options.prefix,placeholder:options.placeholder,i18n:{'URL':this._('URL'),'Edit':this._('Edit')}});slug.keypress(function(){if(event.charCode){sandbox.publish('slug-preview-modified',preview[0]);}});sandbox.publish('slug-preview-created',preview[0]);}
sandbox.subscribe('slug-target-changed',function(value){slug.val(value).trigger('change');});}};});this.ckan.module('basic-form',function($){return{initialize:function(){var message=this._('There are unsaved modifications to this form');$.proxyAll(this,/_on/);this.el.incompleteFormWarning(message);this.el.on('submit',this._onSubmit);},_onSubmit:function(){setTimeout(function(){this.el.find('button[name="save"]').attr('disabled',true);}.bind(this),0);}};});this.ckan.module('confirm-action',function(jQuery){return{options:{content:'',withData:'',i18n:{content:'',},template:['<div class="modal fade">','<div class="modal-dialog">','<div class="modal-content">','<div class="modal-header">','<h3 class="modal-title"></h3>','<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>','</div>','<div class="modal-body"></div>','<div class="modal-footer">','<button class="btn btn-secondary btn-cancel"></button>','<button class="btn btn-primary"></button>','</div>','</div>','</div>','</div>'].join('\n')},initialize:function(){jQuery.proxyAll(this,/_on/);this.el.on('click',this._onClick);},confirm:function(){this.sandbox.body.append(this.createModal());this.modal.modal('show');this.modal.css({'margin-top':this.modal.height()*-0.5,'top':'50%'});},performAction:function(){var form=this.el.closest('form');if(form.attr('hx-post')||form.attr('hx-get')){this.modal.modal('hide');htmx.trigger(form[0],'submit');return;}
if(!this.options.withData&&!form.attr('hx-post')){form=jQuery('<form/>',{action:this.el.attr('href'),method:'POST'});}
var csrf_field=$('meta[name=csrf_field_name]').attr('content');var csrf_value=$('meta[name='+csrf_field+']').attr('content')
var hidden_csrf_input=$('<input name="'+csrf_field+'" type="hidden" value="'+csrf_value+'">')
hidden_csrf_input.prependTo(form)
form.appendTo('body').submit();},createModal:function(){if(!this.modal){var element=this.modal=jQuery(this.options.template);element.on('click','.btn-primary',this._onConfirmSuccess);element.on('click','.btn-cancel',this._onConfirmCancel);element.modal({show:false});element.find('.modal-title').text(this._('Please Confirm Action'));var content=this.options.content||this.options.i18n.content||this._('Are you sure you want to perform this action?');element.find('.modal-body').text(content);element.find('.btn-primary').text(this._('Confirm'));element.find('.btn-cancel').text(this._('Cancel'));element.find('.btn-close').attr("aria-label",this._('Close'));}
return this.modal;},_onClick:function(event){event.preventDefault();this.confirm();},_onConfirmSuccess:function(event){this.performAction();},_onConfirmCancel:function(event){this.modal.modal('hide');}};});this.ckan.module('autocomplete',function(jQuery){return{options:{tags:false,createtags:true,key:false,label:false,items:10,source:null,tokensep:',',interval:300,dropdownClass:'',containerClass:'',minimumInputLength:0},initialize:function(){jQuery.proxyAll(this,/_on/,/format/);this.setupAutoComplete();},setupAutoComplete:function(){var settings={width:'resolve',formatResult:this.formatResult,formatNoMatches:this.formatNoMatches,formatInputTooShort:this.formatInputTooShort,dropdownCssClass:this.options.dropdownClass,containerCssClass:this.options.containerClass,tokenSeparators:this.options.tokensep.split(''),minimumInputLength:this.options.minimumInputLength};if(!this.el.is('select')){if(this.options.tags){settings.tags=this._onQuery;if(!this.options.createtags){settings.createSearchChoice=function(params){return undefined;}}}else{settings.query=this._onQuery;settings.createSearchChoice=this.formatTerm;}
settings.initSelection=this.formatInitialValue;}
else{if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var ieversion=new Number(RegExp.$1);if(ieversion<=7){return}}}
var select2=this.el.select2(settings).data('select2');if(this.options.tags&&select2&&select2.search){select2.search.on('keydown',this._onKeydown);}
$('.select2-choice',select2.container).on('click',function(){return false;});this._select2=select2;},getCompletions:function(string,fn){var parts=this.options.source.split('?');var end=parts.pop();var source=parts.join('?')+encodeURIComponent(string)+end;var client=this.sandbox.client;var options={format:function(data){var completion_options=jQuery.extend(options,{objects:true});return{results:client.parseCompletions(data,completion_options)}},key:this.options.key,label:this.options.label};return client.getCompletions(source,options,fn);},lookup:function(string,fn){var module=this;this._lastTerm=string;clearTimeout(this._debounced);if(!string){fn({results:[]});}else{this._debounced=setTimeout(function(){var term=module._lastTerm;if(module._last&&typeof module._last.abort=='function'){module._last.abort();}
module._last=module.getCompletions(term,fn);},this.options.interval);$('.select2-search input',this._select2.dropdown).addClass('select2-active');}},formatResult:function(state,container,query,escapeMarkup){var term=this._lastTerm||(query?query.term:null)||null;if(container){container.attr('data-value',state.id);}
var result=[];$(state.text.split(term)).each(function(){result.push(escapeMarkup?escapeMarkup(this):this);});return result.join(term&&(escapeMarkup?escapeMarkup(term):term).bold());},formatNoMatches:function(term){return!term?this._('Start typingâ€¦'):this._('No matches found');},formatInputTooShort:function(term,min){return this.ngettext('Input is too short, must be at least one character','Input is too short, must be at least %(num)d characters',min);},formatTerm:function(term){term=jQuery.trim(term||'');return{id:term.replace(/,/g,'\u002C'),text:term};},formatInitialValue:function(element,callback){var value=jQuery.trim(element.val()||'');var formatted;if(this.options.tags){formatted=jQuery.map(value.split(","),this.formatTerm);}else{formatted=this.formatTerm(value);}
if(typeof callback==='function'){callback(formatted);}
return formatted;},_onQuery:function(options){if(options){this.lookup(options.term,options.callback);}},_onKeydown:function(event){if(typeof event.key!=='undefined'?event.key===',':event.which===188){event.preventDefault();setTimeout(function(){var e=jQuery.Event("keydown",{which:13});jQuery(event.target).trigger(e);},10);}}};});this.ckan.module('custom-fields',function(jQuery){return{options:{fieldSelector:'.control-custom'},initialize:function(){jQuery.proxyAll(this,/_on/);var delegated=this.options.fieldSelector+':last input:first';this.el.on('change',delegated,this._onChange);this.el.on('change',':checkbox',this._onRemove);},newField:function(element){this.el.append(this.cloneField(element));},cloneField:function(current){return this.resetField(jQuery(current).clone());},resetField:function(field){function increment(index,string){return(string||'').replace(/\d+/,function(int){return 1+parseInt(int,10);});}
var input=field.find(':input');input.val('').attr('id',increment).attr('name',increment);var label=field.find('label');label.text(increment).attr('for',increment);return field;},disableField:function(field,disable){field.toggleClass('disabled',disable!==false);},_onChange:function(event){if(event.target.value!==''){var parent=jQuery(event.target).parents(this.options.fieldSelector);this.newField(parent);}},_onRemove:function(event){var parent=jQuery(event.target).parents(this.options.fieldSelector);this.disableField(parent,event.target.checked);}};});this.ckan.module('data-viewer',function(jQuery){return{options:{timeout:200,minHeight:400,padding:30},initialize:function(){jQuery.proxyAll(this,/_on/);this.el.on('load',this._onLoad);this._FirefoxFix();this.sandbox.subscribe('data-viewer-error',this._onDataViewerError);},_onDataViewerError:function(message){var parent=this.el.parent();$('.data-viewer-error .collapse',parent).html(message);$('.data-viewer-error',parent).removeClass('js-hide');this.el.hide();},_onLoad:function(){var self=this;var loc=$('body').data('site-root');if(this.el.attr('src').substring(0,loc.length)===loc){this._recalibrate();setTimeout(function(){self._recalibrate();},this.options.timeout);}else{this.el.css('height',600);}},_recalibrate:function(){var height=this.el.contents().find('body').outerHeight(true);height=Math.max(height,this.options.minHeight);this.el.css('height',height+this.options.padding);},_FirefoxFix:function(){if(/#$/.test(this.el.src)){this.el.src=this.el.src.substr(0,this.src.length-1);}else{this.el.src=this.el.src+'#';}}};});this.ckan.module('table-selectable-rows',function($){return{select_all:null,total_checkboxes:0,buttons:null,initialize:function(){$.proxyAll(this,/_on/);this.total_checkboxes=$('input[type="checkbox"]',this.el).length;this.select_all=$('<input type="checkbox">').data('select-all',true).appendTo($('thead th:first-child',this.el));this.el.on('change','input[type="checkbox"]',this._onHandleCheckboxToggle);this.buttons=$('th.actions .btn',this.el).addClass('disabled').prop('disabled',true);},_onHandleCheckboxToggle:function($e){var checkbox=$($e.target);if(checkbox.data('select-all')){this.handleSelectAll(checkbox,checkbox.is(':checked'));}else{this.handleSelectOne(checkbox,checkbox.is(':checked'));}},handleSelectAll:function($target,$checked){$('input[type="checkbox"]',this.el).prop('checked',$checked);if($checked){$('tbody tr',this.el).addClass('table-selected');this.buttons.removeClass('disabled').prop('disabled',false);}else{$('tbody tr',this.el).removeClass('table-selected');this.buttons.addClass('disabled').prop('disabled',true);}},handleSelectOne:function($target,$checked){if($checked){$target.parents('tr').addClass('table-selected');}else{$target.parents('tr').removeClass('table-selected');}
var checked=$('tbody input[type="checkbox"]:checked',this.el).length;if(checked>=this.total_checkboxes){this.select_all.prop('checked',true);}else{this.select_all.prop('checked',false);}
if(checked>0){this.buttons.removeClass('disabled').prop('disabled',false);}else{this.buttons.addClass('disabled').prop('disabled',true);}}};});this.ckan.module('resource-form',function(jQuery){return{initialize:function(){jQuery.proxyAll(this,/_on/);this.sandbox.subscribe('resource:uploaded',this._onResourceUploaded);},teardown:function(){this.sandbox.unsubscribe('resource:uploaded',this._onResourceUploaded);},_onResourceUploaded:function(resource){var key;var field;for(key in resource){if(resource.hasOwnProperty(key)){field=this.$('[name="'+key+'"]');if(field.is(':checkbox, :radio')){this.$('[value="'+resource[key]+'"]').prop('checked',true);}else if(field.is('select')){field.prop('selected',resource[key]);}else{field.val(resource[key]);}}}}};});this.ckan.module('resource-upload-field',function(jQuery){var _nameIsDirty=!!$('input[name="name"]').val();var urlField=$('#field-resource-url');return{initialize:function(){$('input[name="name"]').on('change',function(){_nameIsDirty=true;});if($('#resource-url-upload').prop('checked')){urlField.attr('type','text');}
$('#resource-link-button').on('click',function(){urlField.attr('type','url');})
$('#field-resource-upload').on('change',function(){if(_nameIsDirty){return;}
var file_name=$(this).val().split(/^C:\\fakepath\\/).pop();var isIE=!!document.documentMode;var isEdge=!isIE&&!!window.StyleMedia;if(isIE||isEdge){var fName=file_name.match(/[^\\\/]+$/);file_name=fName?fName[0]:file_name;}
$('input[name="name"]').val(file_name);});}}});this.ckan.module('resource-reorder',function($){return{options:{id:false},template:{title:'<h1></h1>',help_text:'<p></p>',button:['<a href="javascript:;" class="btn btn-secondary">','<i class="fa fa-bars"></i>','<span></span>','</a>'].join('\n'),form_actions:['<div class="form-actions">','<a href="javascript:;" class="save btn btn-primary"></a>','</div>'].join('\n'),handle:['<a href="javascript:;" class="handle">','<i class="fa fa-arrows"></i>','</a>'].join('\n'),saving:['<span class="saving text-muted m-right">','<i class="fa fa-spinner fa-spin"></i>','<span></span>','</span>'].join('\n')},is_reordering:false,cache:false,initialize:function(){jQuery.proxyAll(this,/_on/);var labelText=this._('Reorder resources');var helpText=this._('You can rearrange the resources by dragging them using the arrow icon. Drag the resource '+'to the right and place it to the desired location on the list. When you are done, click the "Save order" -button.');this.html_title=$(this.template.title).text(labelText).insertBefore(this.el).hide();this.html_help_text=$(this.template.help_text).text(helpText).insertBefore(this.el).hide();var button=$(this.template.button).on('click',this._onHandleStartReorder).appendTo('.page_primary_action');$('span',button).text(labelText);this.html_form_actions=$(this.template.form_actions).hide().insertAfter(this.el);$('.save',this.html_form_actions).text(this._('Save order')).on('click',this._onHandleSave);$('.cancel',this.html_form_actions).text(this._('Cancel')).on('click',this._onHandleCancel);this.html_handles=$(this.template.handle).hide().appendTo($('.resource-item',this.el));this.html_saving=$(this.template.saving).hide().insertBefore($('.save',this.html_form_actions));$('span',this.html_saving).text(this._('Saving...'));this.cache=this.el.html();this.el.sortable().sortable('disable');this._onHandleStartReorder();},_onHandleStartReorder:function(){if(!this.is_reordering){this.html_form_actions.add(this.html_handles).add(this.html_title).add(this.html_help_text).show();this.el.addClass('reordering').sortable('enable');$('.page_primary_action').hide();this.is_reordering=true;}},_onHandleCancel:function(){if(this.is_reordering&&!$('.cancel',this.html_form_actions).hasClass('disabled')){this.reset();this.is_reordering=false;this.el.html(this.cache).sortable().sortable('disable');this.html_handles=$('.handle',this.el);}},_onHandleSave:function(){if(!$('.save',this.html_form_actions).hasClass('disabled')){var module=this;module.html_saving.show();$('.save, .cancel',module.html_form_actions).addClass('disabled');var order=[];$('.resource-item',module.el).each(function(){order.push($(this).data('id'));});module.sandbox.client.call('POST','package_resource_reorder',{id:module.options.id,order:order},function(){module.html_saving.hide();$('.save, .cancel',module.html_form_actions).removeClass('disabled');module.cache=module.el.html();module.reset();module.is_reordering=false;});}},reset:function(){this.html_form_actions.add(this.html_handles).add(this.html_title).add(this.html_help_text).hide();this.el.removeClass('reordering').sortable('disable');$('.page_primary_action').show();}};});this.ckan.module('resource-view-reorder',function($){return{options:{id:false},template:{title:'<h1></h1>',button:['<a href="javascript:;" class="btn btn-secondary">','<i class="fa fa-bars"></i>','<span></span>','</a>'].join('\n'),form_actions:['<div class="form-actions">','<a href="javascript:;" class="cancel btn btn-danger pull-left"></a>','<a href="javascript:;" class="save btn btn-primary"></a>','</div>'].join('\n'),handle:['<a href="javascript:;" class="handle">','<i class="fa fa-arrows"></i>','</a>'].join('\n'),saving:['<span class="saving text-muted m-right">','<i class="fa fa-spinner fa-spin"></i>','<span></span>','</span>'].join('\n')},is_reordering:false,cache:false,initialize:function(){jQuery.proxyAll(this,/_on/);var labelText=this._('Reorder resource view');this.html_title=$(this.template.title).text(labelText).insertBefore(this.el).hide();var button=$(this.template.button).on('click',this._onHandleStartReorder).appendTo('.page_primary_action');$('span',button).text(labelText);this.html_form_actions=$(this.template.form_actions).hide().insertAfter(this.el);$('.save',this.html_form_actions).text(this._('Save order')).on('click',this._onHandleSave);$('.cancel',this.html_form_actions).text(this._('Cancel')).on('click',this._onHandleCancel);this.html_handles=$(this.template.handle).hide().appendTo($('li',this.el));this.html_saving=$(this.template.saving).hide().insertBefore($('.save',this.html_form_actions));$('span',this.html_saving).text(this._('Saving...'));this.cache=this.el.html();this.el.sortable().sortable('disable');},_onHandleStartReorder:function(){if(!this.is_reordering){this.html_form_actions.add(this.html_handles).add(this.html_title).show();this.el.addClass('reordering').sortable('enable');$('.page_primary_action').hide();this.is_reordering=true;}},_onHandleCancel:function(){if(this.is_reordering&&!$('.cancel',this.html_form_actions).hasClass('disabled')){this.reset();this.is_reordering=false;this.el.html(this.cache).sortable().sortable('disable');this.html_handles=$('.handle',this.el);}},_onHandleSave:function(){if(!$('.save',this.html_form_actions).hasClass('disabled')){var module=this;module.html_saving.show();$('.save, .cancel',module.html_form_actions).addClass('disabled');var order=[];$('li',module.el).each(function(){order.push($(this).data('id'));});module.sandbox.client.call('POST','resource_view_reorder',{id:module.options.id,order:order},function(){module.html_saving.hide();$('.save, .cancel',module.html_form_actions).removeClass('disabled');module.cache=module.el.html();module.reset();module.is_reordering=false;});}},reset:function(){this.html_form_actions.add(this.html_handles).add(this.html_title).hide();this.el.removeClass('reordering').sortable('disable');$('.page_primary_action').show();}};});this.ckan.module('resource-view-embed',function($){var modal;var self;function initialize(){self=this;modal=$('#embed-'+this.options.id)
$('body').append(modal);this.el.on('click',_onClick);$('textarea',modal).on('focus',_selectAllCode).on('mouseup',_preventClick);$('input',modal).on('keyup change',_updateValues);_updateEmbedCode();}
function _onClick(event){event.preventDefault();modal.modal('show');}
function _selectAllCode(){$('textarea',modal).select();}
function _updateValues(){self.options.width=$('[name="width"]',modal).val();self.options.height=$('[name="height"]',modal).val();_updateEmbedCode();}
function _updateEmbedCode(){$('[name="code"]',modal).val(_embedCode());}
function _preventClick(event){event.preventDefault();}
function _embedCode(){return'<iframe title="Data viewer" width="'+self.options.width+'" height="'+self.options.height+'" src="'+self.options.url+'" frameBorder="0"></iframe>';}
return{initialize:initialize,options:{id:0,url:'#',width:700,height:400}}});ckan.module('resource-view-filters-form',function(jQuery){'use strict';function applyDropdown(selectField,resourceId){var inputField=selectField.parent().find('input'),filterName=selectField.val(),queryLimit=20;inputField.select2({width:'resolve',minimumInputLength:0,ajax:{url:ckan.url('/api/3/action/datastore_search'),datatype:'json',quietMillis:200,cache:true,data:function(term,page){var offset=(page-1)*queryLimit,query;query={resource_id:resourceId,limit:queryLimit,offset:offset,fields:filterName,distinct:true,sort:filterName,include_total:false};if(term!==''){var q={};if(term.indexOf(' ')==-1){term=term+':*';query.plain=false;}
q[filterName]=term;query.q=JSON.stringify(q);}
return query;},results:function(data,page){var records=data.result.records,hasMore=(records.length==queryLimit),results;results=$.map(records,function(record){return{id:record[filterName],text:String(record[filterName])};});return{results:results,more:hasMore};},},initSelection:function(element,callback){var data={id:element.val(),text:element.val()};callback(data);},});}
function initialize(){var self=this,resourceId=self.options.resourceId,templateFilterInputs=self.options.templateFilterInputs,inputFieldTemplateEl=$(templateFilterInputs).find('input[type="text"][name]'),filtersDiv=self.el.find(self.options.filtersSelector),addFilterEl=self.el.find(self.options.addFilterSelector),removeFilterSelector=self.options.removeFilterSelector;var selects=filtersDiv.find('select');selects.each(function(i,select){applyDropdown($(select),resourceId);});addFilterEl.click(function(evt){var selectField;evt.preventDefault();filtersDiv.append(templateFilterInputs);selectField=filtersDiv.children().last().find('select');applyDropdown(selectField,resourceId);});filtersDiv.on('click',removeFilterSelector,function(evt){evt.preventDefault();$(this).parent().remove();});filtersDiv.on('change','select',function(evt){var el=$(this),parentEl=el.parent(),inputField=parentEl.find('input'),select2Container=parentEl.find('.select2-container');evt.preventDefault();select2Container.remove();inputField.replaceWith(inputFieldTemplateEl.clone());applyDropdown(el,resourceId);});}
return{initialize:initialize};});this.ckan.module('resource-view-filters',function(jQuery){'use strict';function initialize(){var self=this,resourceId=self.options.resourceId,fields=self.options.fields,dropdownTemplate=self.options.dropdownTemplate,addFilterTemplate='<a class="btn btn-primary" href="#">'+self._('Add Filter')+'</a>',filtersDiv=$('<div></div>');var filters=ckan.views.filters.get();_appendDropdowns(filtersDiv,resourceId,dropdownTemplate,fields,filters);var addFilterButton=_buildAddFilterButton(self,filtersDiv,addFilterTemplate,fields,filters,function(evt){var filters={};filters[evt.val]=[];$(this).select2('destroy');_appendDropdowns(filtersDiv,resourceId,dropdownTemplate,fields,filters);evt.preventDefault();});self.el.append(filtersDiv);self.el.append(addFilterButton);}
function _buildAddFilterButton(self,el,template,fields,filters,onChangeCallback){var addFilterButton=$(template),currentFilters=Object.keys(filters),fieldsNotFiltered=$.grep(fields,function(field){return!filters.hasOwnProperty(field);}),data=$.map(fieldsNotFiltered,function(d){return{id:d,text:d};});if(data.length===0){return'';}
addFilterButton.click(function(evt){var addFilterDiv=$('<div class="resource-view-filter"><input type="hidden"></input></div>'),addFilterInput=addFilterDiv.find('input');el.append(addFilterDiv);addFilterInput.select2({data:data,placeholder:self._('Select a field'),width:'resolve',}).on('change',onChangeCallback);evt.preventDefault();});return addFilterButton;}
function _appendDropdowns(dropdowns,resourceId,template,fields,filters){$.each(fields,function(i,field){if(filters.hasOwnProperty(field)){dropdowns.append(_buildDropdown(self.el,template,field));}});return dropdowns;function _buildDropdown(el,template,filterName){var theseFilters=filters[filterName]||[];template=$(template.replace(/{filter}/g,filterName));var dropdowns=template.find('.resource-view-filter-values');theseFilters=theseFilters.concat([undefined]);theseFilters.forEach(function(value,i){var dropdown=$('<input type="hidden" name="'+filterName+'"></input>');if(value!==undefined){dropdown.val(value);}
dropdowns.append(dropdown);});var queryLimit=20;dropdowns.find('input').select2({allowClear:true,placeholder:' ',width:'resolve',minimumInputLength:0,ajax:{url:ckan.url('/api/3/action/datastore_search'),datatype:'json',quietMillis:200,cache:true,data:function(term,page){var offset=(page-1)*queryLimit,query;query={resource_id:resourceId,limit:queryLimit,offset:offset,fields:filterName,distinct:true,sort:filterName,include_total:false};if(term!==''){var q={};if(term.indexOf(' ')==-1){term=term+':*';query.plain=false;}
q[filterName]=term;query.q=JSON.stringify(q);}
return query;},results:function(data,page){var records=data.result.records,hasMore=(records.length==queryLimit),results;results=$.map(records,function(record){return{id:record[filterName],text:String(record[filterName])};});return{results:results,more:hasMore};}},initSelection:function(element,callback){var data={id:element.val(),text:element.val()};callback(data);},}).on('change',_onChange);return template;}}
function _onChange(evt){var filterName=evt.currentTarget.name,filterValue=evt.val,currentFilters=ckan.views.filters.get(filterName)||[],addToIndex=currentFilters.length;currentFilters=currentFilters.slice();if(evt.removed){if(addToIndex!==-1){if(typeof evt.removed.id!=="undefined"&&currentFilters.indexOf(evt.removed.id)!==-1){currentFilters.splice(currentFilters.indexOf(evt.removed.id),1);}}}
if(evt.added){currentFilters.splice(addToIndex,0,filterValue);}
if(currentFilters.length>0){ckan.views.filters.set(filterName,currentFilters);}else{ckan.views.filters.unset(filterName);}}
return{initialize:initialize,options:{dropdownTemplate:['<div class="resource-view-filter">','  {filter}:','  <div class="resource-view-filter-values"></div>','</div>',].join('\n')}};});this.ckan.module('table-toggle-more',function($){return{options:{},initialize:function(){$.proxyAll(this,/_on/);this.el.addClass('table-toggle-more');var rows=$('.toggle-more',this.el).length;if(rows){var cols=$('thead tr th',this.el).length;var template_more=['<tr class="toggle-show toggle-show-more">','<td colspan="'+cols+'">','<small>','<a href="#" class="show-more">'+this._('Show more')+'</a>','<a href="#" class="show-less">'+this._('Hide')+'</a>','</small>','</td>','</tr>'].join('\n');var template_seperator=['<tr class="toggle-seperator">','<td colspan="'+cols+'">','</td>','</tr>'].join('\n');var seperator=$(template_seperator).insertAfter($('.toggle-more:last-child',this.el));$(template_more).insertAfter(seperator);$('.show-more',this.el).on('click',this._onShowMore);$('.show-less',this.el).on('click',this._onShowLess);}},_onShowMore:function($e){$e.preventDefault();this.el.removeClass('table-toggle-more').addClass('table-toggle-less');},_onShowLess:function($e){$e.preventDefault();this.el.removeClass('table-toggle-less').addClass('table-toggle-more');}}});this.ckan.module('dataset-visibility',function($){return{currentValue:false,options:{organizations:$('#field-organizations'),visibility:$('#field-private'),currentValue:null},initialize:function(){$.proxyAll(this,/_on/);this.options.currentValue=this.options.visibility.val();this.options.organizations.on('change',this._onOrganizationChange);this._onOrganizationChange();},_onOrganizationChange:function(){var value=this.options.organizations.val();if(value){this.options.visibility.prop('disabled',false).val(this.options.currentValue);}else{this.options.visibility.prop('disabled',true).val('False');}}};});this.ckan.module('media-grid',function($){return{initialize:function(){var wrapper=this.el;wrapper.imagesLoaded(function(){wrapper.masonry({itemSelector:'.media-item'});});}};});this.ckan.module('image-upload',function($){return{options:{is_url:false,is_upload:false,field_upload:'image_upload',field_url:'image_url',field_clear:'clear_upload',field_name:'name',upload_label:'',previous_upload:false},_nameIsDirty:false,initialize:function(){$.proxyAll(this,/_on/);var options=this.options;var field_upload='input[name="'+options.field_upload+'"]';var field_url='input[name="'+options.field_url+'"]';var field_clear='input[name="'+options.field_clear+'"]';var field_name='input[name="'+options.field_name+'"]';this.input=$(field_upload,this.el);this.field_url=$(field_url,this.el).parents('.form-group');this.field_image=this.input.parents('.form-group');this.field_url_input=$('input',this.field_url);this.field_name=this.el.parents('form').find(field_name);this.label_location=$('label[for="field-image-url"]');this.is_data_resource=(this.options.field_url==='url')&&(this.options.field_upload==='upload');this.previousUpload=this.options.previous_upload;var checkbox=$(field_clear,this.el);if(checkbox.length>0){checkbox.parents('.form-group').remove();}
this.field_clear=$('<input type="hidden" name="'+options.field_clear+'">').appendTo(this.el);this.button_url=$('<a href="javascript:;" class="btn btn-secondary">'+'<i class="fa fa-globe"></i>'+
this._('Link')+'</a>').prop('title',this._('Link to a URL on the internet (you can also link to an API)')).on('click',this._onFromWeb).insertAfter(this.input);this.button_upload=$('<a href="javascript:;" class="btn btn-secondary">'+'<i class="fa fa-cloud-upload"></i>'+
this._('Upload')+'</a>').insertAfter(this.input);if(this.previousUpload){$('<div class="error-inline"><i class="fa fa-warning"></i> '+
this._('Please select the file to upload again')+'</div>').appendTo(this.field_image);}
var removeText=this._('Remove');$('<a href="javascript:;" class="btn btn-danger btn-remove-url">'
+removeText+'</a>').prop('title',removeText).on('click',this._onRemove).insertBefore(this.field_url_input);$('label[for="field-image-upload"]').text(options.upload_label||this._('Image'));this.input.on('mouseover',this._onInputMouseOver).on('mouseout',this._onInputMouseOut).on('change',this._onInputChange).prop('title',this._('Upload a file on your computer')).css('width',this.button_upload.outerWidth());this.fields=$('<i />').add(this.button_upload).add(this.button_url).add(this.input).add(this.field_url).add(this.field_image);this.field_name.on('change',this._onModifyName);if(this.field_name.val()){this._nameIsDirty=true;}
if(options.is_url){this._showOnlyFieldUrl();this._updateUrlLabel(this._('URL'));}else if(options.is_upload){this._showOnlyFieldUrl();this.field_url_input.prop('readonly',true);var filename=this._fileNameFromUpload(this.field_url_input.val());this.field_url_input.val(filename);this._updateUrlLabel(this._('File'));}else{this._showOnlyButtons();}},_fileNameFromUpload:function(url){if(/^\/base\/images/.test(url)){return url;}
url=url.substring(0,(url.indexOf("#")===-1)?url.length:url.indexOf("#"));url=url.substring(0,(url.indexOf("?")===-1)?url.length:url.indexOf("?"));url=url.substring(url.lastIndexOf("/")+1,url.length);return url;},_updateUrlLabel:function(label_text){if(!this.is_data_resource){return;}
this.label_location.text(label_text);},_onFromWeb:function(){this._showOnlyFieldUrl();this.field_url_input.focus().on('blur',this._onFromWebBlur);if(this.options.is_upload){this.field_clear.val('true');}
this._updateUrlLabel(this._('URL'));},_onRemove:function(){this._showOnlyButtons();this.field_url_input.val('');this.field_url_input.prop('readonly',false);this.field_clear.val('true');},_onInputChange:function(){var file_name=this.input.val().split(/^C:\\fakepath\\/).pop();var isIE=!!document.documentMode;var isEdge=!isIE&&!!window.StyleMedia;if(isIE||isEdge){var fName=file_name.match(/[^\\\/]+$/);file_name=fName?fName[0]:file_name;}
this.field_url_input.val(file_name);this.field_url_input.prop('readonly',true);this.field_clear.val('');this._showOnlyFieldUrl();this._autoName(file_name);this._updateUrlLabel(this._('File'));},_showOnlyButtons:function(){this.fields.hide();this.button_upload.add(this.field_image).add(this.button_url).add(this.input).show();},_showOnlyFieldUrl:function(){this.fields.hide();this.field_url.show();},_onInputMouseOver:function(){this.button_upload.addClass('hover');},_onInputMouseOut:function(){this.button_upload.removeClass('hover');},_onModifyName:function(){this._nameIsDirty=true;},_onFromWebBlur:function(){var url=this.field_url_input.val().match(/([^\/]+)\/?$/)
if(url){this._autoName(url.pop());}},_autoName:function(name){if(!this._nameIsDirty){this.field_name.val(name);}}};});ckan.module('metadata-button',function(jQuery){return{options:{target:'button'},initialize:function(){this.el.on('click',jQuery.proxy(this._onClick,this));},_onClick:function(event){console.log("PRESSED THE BUTTON");var div=document.getElementById("metadata_diff");if(div.style.display==="none"){div.style.display="block";}
else{div.style.display="none";}
var btn=document.getElementById("metadata_button");if(btn.value==="Show metadata diff"){btn.value="Hide metadata diff";}
else{btn.value="Show metadata diff";}}}});this.ckan.module("copy-into-buffer",function($){"use strict";return{options:{copyValue:null,},initialize:function(){this._onClick=this._onClick.bind(this);this.el.on("click",this._onClick);},teardown:function(){this.el.off("click",this._onClick);},_onClick:function(event){event.preventDefault();this.copy(this.options.copyValue);},copy:function(value){var container=$("<textarea>");container.val(value);container.css({opacity:0,position:"fixed",top:0,bottom:0,});container.appendTo(document.body);container.focus();container.select();document.execCommand("copy");container.remove();},};});