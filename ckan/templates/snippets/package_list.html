{#
Displays a list of datasets.

packages       - A list of packages to display.
list_class     - The class name for the list item.
item_class     - The class name to use on each item.
hide_resources - If true hides the resources (default: false).
banner         - If true displays a popular banner (default: false).
truncate       - The length to trucate the description to (default: 180)
truncate_title - The length to truncate the title to (default: 80).

Example:

  {% snippet 'snippets/package_list.html', packages=c.datasets %}

#}
{% set list_class = list_class or 'dataset-list unstyled' %}
{% set item_class = item_class or 'dataset-item' %}
{% set truncate = truncate or 180 %}
{% set truncate_title = truncate_title or 80 %}

{% if packages %}
  <ul class="{{ list_class }}">
    {% for package in packages %}
      {% set title = package.get('title') or package.get('name') %}
      {% set notes = h.markdown_extract(package.notes, extract_length=truncate) %}

      <li class="{{ item_class }} ">
      <div class="dataset-content">
          <h3 class="dataset-heading">
            {{ h.link_to(h.truncate(title, truncate_title), h.url_for(controller='package', action='read', id=package.get('name'))) }}
            {% if package.state.startswith('draft') %}
              [{{ _('Draft') }}]
            {% endif %}
            {{ h.popular('recent views', package.tracking_summary.recent, min=10) if package.tracking_summary }}
          </h3>
          {% if banner %}
            <span class="banner">Popular</span>
          {% endif %}
          {% if notes %}
            <div>{{ notes|urlize }}</div>
          {% else %}
            <p class="empty">{{ _("This dataset has no description") }}</p>
          {% endif %}
        </div>
        {% if package.resources and not hide_resources %}
          <ul class="dataset-resources unstyled">
            {% for resource in h.dict_list_reduce(package.resources, 'format') %}
              <li>
                <a href="{{ h.url_for(controller='package', action='read', id=package.get('name')) }}" class="label" data-format="{{ resource.lower() }}">{{ resource }}</a>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% endif %}
