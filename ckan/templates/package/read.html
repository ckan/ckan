<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude">

  <py:def function="page_title">Packages - ${c.pkg.name}</py:def>

  <py:match path="primarysidebar">
    <div class="box">
      <div class="information">
        <dl class="icons clearfix">
          <dt>${h.icon('user')}</dt>
          <dd>${c.pkg_author_link}</dd>
          <dt>${h.icon('user_grey')}</dt>
          <dd>${c.pkg_maintainer_link}</dd>
          <dt>${h.icon('package')}</dt>
          <dd>Version <strong>${c.pkg.version}</strong></dd>
          <dt>${package_license_icon(c.pkg)}</dt>
          <py:choose test="">
            <dd py:when="c.pkg.license and c.pkg.license.url"><a href="${c.pkg.license.url}">${c.pkg.license.title}</a></dd>
            <dd py:when="c.pkg.license">${c.pkg.license.title}</dd>
            <dd py:when="c.pkg.license_id">${c.pkg.license_id}</dd>
            <dd py:otherwise="">
              License not given
            </dd>
          </py:choose>
          <dt>${package_resources_icon(c.pkg)}</dt>
          <dd>${"Downloadable resources" if c.pkg.resources else "No resources"}</dd>
        </dl>
        <py:if test="c.package_relationships">
          <h3>Related packages</h3>
          <ul>
            <py:for each="pkg, relationship_str in c.package_relationships">
              <li>${h.literal(relationship_str % (h.link_to(pkg.name, h.url_for(controller="package", action="read", id=pkg.name))))}</li>
            </py:for>
          </ul>
        </py:if>
      </div>
    </div>

    <div class="box">
      <h2>Openness:
        <py:choose test="">
        <span py:when="c.pkg.isopen() and c.pkg.resources" class="okd">
          OPEN
        </span>
        <span py:otherwise="">
          NOT OPEN
        </span>
        </py:choose>
      </h2>
      <py:choose test="">
        <p py:when="c.pkg.license_id">
          This package is licensed with
          <py:choose test="">
            <strong py:when="c.pkg.license and c.pkg.license.url"><br /><a href="${c.pkg.license.url}">${c.pkg.license.title}</a></strong>
            <strong py:when="c.pkg.license"><br />${c.pkg.license.title}</strong>
            <strong py:when="c.pkg.license_id"><br />${c.pkg.license_id}</strong>
          </py:choose>
        </p>
        <p py:otherwise="">
          License not given
        </p>
      </py:choose>

      <py:choose>
        <p py:when="c.pkg.isopen() and c.pkg.resources" class="okd">
          <a
            href="http://www.opendefinition.org/okd/"
            title="This package satisfies the Open Knowledge Definition.">
            <img src="http://m.okfn.org/images/ok_buttons/od_80x15_blue.png" alt="[Open Data]" /></a>
          <a
            href="http://www.opendefinition.org/okd/"
            title="This package satisfies the Open Knowledge Definition.">
            <img src="http://m.okfn.org/images/ok_buttons/oc_80x15_blue.png" alt="[Open Content]" /></a>
        </p>
      <div py:otherwise="">
      <h5>Help Make This Package Open!</h5>
      <p>This package is <strong>not open</strong> as it is
      <strong>not openly licensed</strong> or is
      <strong>missing downloadable resources</strong>. Help
      make it open by 
        <a href="http://www.isitopendata.org/enquiry/start/?ckan_package=${c.pkg.name}">starting an enquiry</a>
        using the
        <a href="http://www.isitopendata.org/">Is It Open
          Data service</a>.</p>
      </div>
      </py:choose>
    </div>

    <py:if test="c.auth_for_edit">
    <div class="box">
      <h2>Edit this Package</h2>
        <p>
          Can you help us keep this page up to date?
          If so, why not
          <a href="${h.url_for(controller='package',action='edit',id=c.pkg.name)}">
            update the package information</a>.
        </p>
    </div>
    </py:if>

    <div class="box">
      <div class="formats">
        <h2>Alternative metadata formats</h2>
        <ul class="clearfix">
          <li>
            <a href="${h.url_for(controller='rest', register='package', action='show', id=c.pkg.name)}">
              <img src="${h.icon_url('page_white_json')}" title="JSON format" alt="JSON" /></a>
          </li>
          <li py:if="config.get('rdf_packages')">
            <a href="${config.get('rdf_packages') + c.pkg.name}">
              <img src="${h.icon_url('page_white_rdf')}" title="RDF format" alt="RDF" />
            </a>
          </li>
        </ul>
      </div>
    </div>
  </py:match>

  <div py:match="content" class="package">
    <xi:include href="read_core.html" />
  </div>

  <py:if test="config.get('rdf_packages')">
    <py:def function="optional_head">
      <link rel="alternate" type="application/rdf+xml" title="RDF Version" href="${config['rdf_packages']}${c.pkg.name}" />
    </py:def>
  </py:if>

  <py:def function="optional_feed">
  <link rel="alternate" type="application/atom+xml" title="Package History" href="/package/history/${c.pkg.name}?format=atom&amp;days=7" />
  </py:def>

  <xi:include href="layout.html" />
</html>

