
(function($){if(typeof $.fn.each2=="undefined"){$.fn.extend({each2:function(c){var j=$([0]),i=-1,l=this.length;while(++i<l&&(j.context=j[0]=this[i])&&c.call(j[0],i,j)!==false);return this;}});}})(jQuery);(function($,undefined){"use strict";if(window.Select2!==undefined){return;}
var KEY,AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer;KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(k){k=k.which?k.which:k;switch(k){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return true;}
return false;},isControl:function(k){k=k.which?k.which:k;switch(k){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return true;}
if(k.metaKey)return true;return false;},isFunctionKey:function(k){k=k.which?k.which:k;return k>=112&&k<=123;}};nextUid=(function(){var counter=1;return function(){return counter++;};}());function escapeMarkup(markup){if(markup&&typeof(markup)==="string"){return markup.replace("&","&amp;");}else{return markup;}}
function indexOf(value,array){var i=0,l=array.length,v;if(typeof value==="undefined"){return-1;}
if(value.constructor===String){for(;i<l;i=i+1)if(value.localeCompare(array[i])===0)return i;}else{for(;i<l;i=i+1){v=array[i];if(v.constructor===String){if(v.localeCompare(value)===0)return i;}else{if(v===value)return i;}}}
return-1;}
function equal(a,b){if(a===b)return true;if(a===undefined||b===undefined)return false;if(a===null||b===null)return false;if(a.constructor===String)return a.localeCompare(b)===0;if(b.constructor===String)return b.localeCompare(a)===0;return false;}
function splitVal(string,separator){var val,i,l;if(string===null||string.length<1)return[];val=string.split(separator);for(i=0,l=val.length;i<l;i=i+1)val[i]=$.trim(val[i]);return val;}
function getSideBorderPadding(element){return element.outerWidth()-element.width();}
function installKeyUpChangeEvent(element){var key="keyup-change-value";element.bind("keydown",function(){if($.data(element,key)===undefined){$.data(element,key,element.val());}});element.bind("keyup",function(){var val=$.data(element,key);if(val!==undefined&&element.val()!==val){$.removeData(element,key);element.trigger("keyup-change");}});}
$(document).delegate("*","mousemove",function(e){$.data(document,"select2-lastpos",{x:e.pageX,y:e.pageY});});function installFilteredMouseMove(element){element.bind("mousemove",function(e){var lastpos=$.data(document,"select2-lastpos");if(lastpos===undefined||lastpos.x!==e.pageX||lastpos.y!==e.pageY){$(e.target).trigger("mousemove-filtered",e);}});}
function debounce(quietMillis,fn){var timeout;return function(){window.clearTimeout(timeout);timeout=window.setTimeout(fn,quietMillis);};}
function thunk(formula){var evaluated=false,value;return function(){if(evaluated===false){value=formula();evaluated=true;}
return value;};};function installDebouncedScroll(threshold,element){var notify=debounce(threshold,function(e){element.trigger("scroll-debounced",e);});element.bind("scroll",function(e){if(indexOf(e.target,element.get())>=0)notify(e);});}
function killEvent(event){event.preventDefault();event.stopPropagation();}
function measureTextWidth(e){if(!sizer){var style=e[0].currentStyle||window.getComputedStyle(e[0],null);sizer=$("<div></div>").css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:style.fontSize,fontFamily:style.fontFamily,fontStyle:style.fontStyle,fontWeight:style.fontWeight,letterSpacing:style.letterSpacing,textTransform:style.textTransform,whiteSpace:"nowrap"});$("body").append(sizer);}
sizer.text(e.val());return sizer.width();}
function markMatch(text,term,markup){var match=text.toUpperCase().indexOf(term.toUpperCase()),tl=term.length;if(match<0){markup.push(text);return;}
markup.push(text.substring(0,match));markup.push("<span class='select2-match'>");markup.push(text.substring(match,match+tl));markup.push("</span>");markup.push(text.substring(match+tl,text.length));}
function ajax(options){var timeout,requestSequence=0,handler=null,quietMillis=options.quietMillis||100;return function(query){window.clearTimeout(timeout);timeout=window.setTimeout(function(){requestSequence+=1;var requestNumber=requestSequence,data=options.data,transport=options.transport||$.ajax,type=options.type||'GET';data=data.call(this,query.term,query.page,query.context);if(null!==handler){handler.abort();}
handler=transport.call(null,{url:options.url,dataType:options.dataType,data:data,type:type,success:function(data){if(requestNumber<requestSequence){return;}
var results=options.results(data,query.page);query.callback(results);}});},quietMillis);};}
function local(options){var data=options,dataText,text=function(item){return""+item.text;};if(!$.isArray(data)){text=data.text;if(!$.isFunction(text)){dataText=data.text;text=function(item){return item[dataText];};}
data=data.results;}
return function(query){var t=query.term,filtered={};if(t===""){query.callback({results:data});return;}
filtered.results=$(data).filter(function(){return query.matcher(t,text(this));}).get();query.callback(filtered);};}
function tags(data){if($.isFunction(data)){return data;}
return function(query){var t=query.term,filtered={results:[]};$(data).each(function(){var isObject=this.text!==undefined,text=isObject?this.text:this;if(t===""||query.matcher(t,text)){filtered.results.push(isObject?this:{id:this,text:this});}});query.callback(filtered);};}
function checkFormatter(formatter,formatterName){if($.isFunction(formatter))return true;if(!formatter)return fasle;throw new Error("formatterName must be a function or a falsy value");}
$(document).ready(function(){$(document).delegate("*","mousedown touchend",function(e){var target=$(e.target).closest("div.select2-container").get(0),attr;if(target){$(document).find("div.select2-container-active").each(function(){if(this!==target)$(this).data("select2").blur();});}else{target=$(e.target).closest("div.select2-drop").get(0);$(document).find("div.select2-drop-active").each(function(){if(this!==target)$(this).data("select2").blur();});}
target=$(e.target);attr=target.attr("for");if("LABEL"===e.target.tagName&&attr&&attr.length>0){target=$("#"+attr);target=target.data("select2");if(target!==undefined){target.focus();e.preventDefault();}}});});function evaluate(val){return $.isFunction(val)?val():val;}
function clazz(SuperClass,methods){var constructor=function(){};constructor.prototype=new SuperClass;constructor.prototype.constructor=constructor;constructor.prototype.parent=SuperClass.prototype;constructor.prototype=$.extend(constructor.prototype,methods);return constructor;}
AbstractSelect2=clazz(Object,{bind:function(func){var self=this;return function(){func.apply(self,arguments);};},init:function(opts){var results,search,resultsSelector=".select2-results";this.opts=opts=this.prepareOpts(opts);this.id=opts.id;if(opts.element.data("select2")!==undefined&&opts.element.data("select2")!==null){this.destroy();}
this.enabled=true;this.container=this.createContainer();this.body=thunk(function(){return opts.element.closest("body");});if(opts.element.attr("class")!==undefined){this.container.addClass(opts.element.attr("class"));}
this.container.css(evaluate(opts.containerCss));this.container.addClass(evaluate(opts.containerCssClass));this.opts.element.data("select2",this).hide().after(this.container);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");this.dropdown.css(evaluate(opts.dropdownCss));this.dropdown.addClass(evaluate(opts.dropdownCssClass));this.dropdown.data("select2",this);this.results=results=this.container.find(resultsSelector);this.search=search=this.container.find("input.select2-input");search.attr("tabIndex",this.opts.element.attr("tabIndex"));this.resultsPage=0;this.context=null;this.initContainer();this.initContainerWidth();installFilteredMouseMove(this.results);this.dropdown.delegate(resultsSelector,"mousemove-filtered",this.bind(this.highlightUnderEvent));installDebouncedScroll(80,this.results);this.dropdown.delegate(resultsSelector,"scroll-debounced",this.bind(this.loadMoreIfNeeded));if($.fn.mousewheel){results.mousewheel(function(e,delta,deltaX,deltaY){var top=results.scrollTop(),height;if(deltaY>0&&top-deltaY<=0){results.scrollTop(0);killEvent(e);}else if(deltaY<0&&results.get(0).scrollHeight-results.scrollTop()+deltaY<=results.height()){results.scrollTop(results.get(0).scrollHeight-results.height());killEvent(e);}});}
installKeyUpChangeEvent(search);search.bind("keyup-change",this.bind(this.updateResults));search.bind("focus",function(){search.addClass("select2-focused");if(search.val()===" ")search.val("");});search.bind("blur",function(){search.removeClass("select2-focused");});this.dropdown.delegate(resultsSelector,"mouseup",this.bind(function(e){if($(e.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0){this.highlightUnderEvent(e);this.selectHighlighted(e);}else{this.focusSearch();}
killEvent(e);}));this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation();});if($.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource();}
if(opts.element.is(":disabled"))this.disable();},destroy:function(){var select2=this.opts.element.data("select2");if(select2!==undefined){select2.container.remove();select2.dropdown.remove();select2.opts.element.removeData("select2").unbind(".select2").show();}},prepareOpts:function(opts){var element,select,idKey,ajaxUrl;element=opts.element;if(element.get(0).tagName.toLowerCase()==="select"){this.select=select=opts.element;}
opts.separator=opts.separator||",";if(select){$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in opts){throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.");}});}
opts=$.extend({},{populateResults:function(container,results,query){var populate,data,result,children,id=this.opts.id;populate=function(results,container,depth){var i,l,result,selectable,compound,node,label,innerContainer,formatted;for(i=0,l=results.length;i<l;i=i+1){result=results[i];selectable=id(result)!==undefined;compound=("children"in result)&&result.children.length>0;node=$("<li></li>");node.addClass("select2-results-dept-"+depth);node.addClass("select2-result");node.addClass(selectable?"select2-result-selectable":"select2-result-unselectable");if(compound){node.addClass("select2-result-with-children");}
label=$("<div></div>");label.addClass("select2-result-label");formatted=opts.formatResult(result,label,query);if(formatted!==undefined){label.html(escapeMarkup(formatted));}
node.append(label);if(compound){innerContainer=$("<ul></ul>");innerContainer.addClass("select2-result-sub");populate(result.children,innerContainer,depth+1);node.append(innerContainer);}
node.data("select2-data",result);container.append(node);}};populate(results,container,0);}},$.fn.select2.defaults,opts);if(typeof(opts.id)!=="function"){idKey=opts.id;opts.id=function(e){return e[idKey];};}
if(select){opts.query=this.bind(function(query){var data={results:[],more:false},term=query.term,children,firstChild,process;process=function(element,collection){var group;if(element.is("option")){if(query.matcher(term,element.text(),element)){collection.push({id:element.attr("value"),text:element.text(),element:element.get()});}}else if(element.is("optgroup")){group={text:element.attr("label"),children:[],element:element.get()};element.children().each2(function(i,elm){process(elm,group.children);});if(group.children.length>0){collection.push(group);}}};children=element.children();if(this.getPlaceholder()!==undefined&&children.length>0){firstChild=children[0];if($(firstChild).text()===""){children=children.not(firstChild);}}
children.each2(function(i,elm){process(elm,data.results);});query.callback(data);});opts.id=function(e){return e.id;};}else{if(!("query"in opts)){if("ajax"in opts){ajaxUrl=opts.element.data("ajax-url");if(ajaxUrl&&ajaxUrl.length>0){opts.ajax.url=ajaxUrl;}
opts.query=ajax(opts.ajax);}else if("data"in opts){opts.query=local(opts.data);}else if("tags"in opts){opts.query=tags(opts.tags);opts.createSearchChoice=function(term){return{id:term,text:term};};opts.initSelection=function(element,callback){var data=[];$(splitVal(element.val(),opts.separator)).each(function(){var id=this,text=this,tags=opts.tags;if($.isFunction(tags))tags=tags();$(tags).each(function(){if(equal(this.id,id)){text=this.text;return false;}});data.push({id:id,text:text});});callback(data);};}}}
if(typeof(opts.query)!=="function"){throw"query function not defined for Select2 "+opts.element.attr("id");}
return opts;},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(e){if(this.opts.element.data("select2-change-triggered")!==true){this.initSelection();}}));},triggerChange:function(details){details=details||{};details=$.extend({},details,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",true);this.opts.element.trigger(details);this.opts.element.data("select2-change-triggered",false);this.opts.element.click();},enable:function(){if(this.enabled)return;this.enabled=true;this.container.removeClass("select2-container-disabled");},disable:function(){if(!this.enabled)return;this.close();this.enabled=false;this.container.addClass("select2-container-disabled");},opened:function(){return this.container.hasClass("select2-dropdown-open");},positionDropdown:function(){var offset=this.container.offset(),height=this.container.outerHeight(),width=this.container.outerWidth(),dropHeight=this.dropdown.outerHeight(),viewportBottom=$(window).scrollTop()+document.documentElement.clientHeight,dropTop=offset.top+height,enoughRoomBelow=dropTop+dropHeight<=viewportBottom,enoughRoomAbove=(offset.top-dropHeight)>=this.body().scrollTop(),aboveNow=this.dropdown.hasClass("select2-drop-above"),above,css;if(aboveNow){above=true;if(!enoughRoomAbove&&enoughRoomBelow)above=false;}else{above=false;if(!enoughRoomBelow&&enoughRoomAbove)above=true;}
if(above){dropTop=offset.top-dropHeight;this.container.addClass("select2-drop-above");this.dropdown.addClass("select2-drop-above");}
else{this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above");}
css={top:dropTop,left:offset.left,width:width};this.dropdown.css(css);},shouldOpen:function(){var event;if(this.opened())return false;event=jQuery.Event("open");this.opts.element.trigger(event);return!event.isDefaultPrevented();},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above");},open:function(){if(!this.shouldOpen())return false;window.setTimeout(this.bind(this.opening),1);return true;},opening:function(){this.clearDropdownAlignmentPreference();if(this.search.val()===" "){this.search.val("");}
this.dropdown.addClass("select2-drop-active");this.container.addClass("select2-dropdown-open").addClass("select2-container-active");this.updateResults(true);if(this.dropdown[0]!==this.body().children().last()[0]){this.dropdown.detach().appendTo(this.body());}
this.dropdown.show();this.ensureHighlightVisible();this.positionDropdown();this.focusSearch();},close:function(){if(!this.opened())return;this.clearDropdownAlignmentPreference();this.dropdown.hide();this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");this.results.empty();this.clearSearch();this.opts.element.trigger(jQuery.Event("close"));},clearSearch:function(){},ensureHighlightVisible:function(){var results=this.results,children,index,child,hb,rb,y,more;index=this.highlight();if(index<0)return;if(index==0){results.scrollTop(0);return;}
children=results.find(".select2-result-selectable");child=$(children[index]);hb=child.offset().top+child.outerHeight();if(index===children.length-1){more=results.find("li.select2-more-results");if(more.length>0){hb=more.offset().top+more.outerHeight();}}
rb=results.offset().top+results.outerHeight();if(hb>rb){results.scrollTop(results.scrollTop()+(hb-rb));}
y=child.offset().top-results.offset().top;if(y<0){results.scrollTop(results.scrollTop()+y);}},moveHighlight:function(delta){var choices=this.results.find(".select2-result-selectable"),index=this.highlight();while(index>-1&&index<choices.length){index+=delta;var choice=$(choices[index]);if(choice.hasClass("select2-result-selectable")&&!choice.hasClass("select2-disabled")){this.highlight(index);break;}}},highlight:function(index){var choices=this.results.find(".select2-result-selectable").not(".select2-disabled");if(arguments.length===0){return indexOf(choices.filter(".select2-highlighted")[0],choices.get());}
if(index>=choices.length)index=choices.length-1;if(index<0)index=0;choices.removeClass("select2-highlighted");$(choices[index]).addClass("select2-highlighted");this.ensureHighlightVisible();},countSelectableResults:function(){return this.results.find(".select2-result-selectable").not(".select2-disabled").length;},highlightUnderEvent:function(event){var el=$(event.target).closest(".select2-result-selectable");if(el.length>0&&!el.is(".select2-highlighted")){var choices=this.results.find('.select2-result-selectable');this.highlight(choices.index(el));}else if(el.length==0){this.results.find(".select2-highlighted").removeClass("select2-highlighted");}},loadMoreIfNeeded:function(){var results=this.results,more=results.find("li.select2-more-results"),below,offset=-1,page=this.resultsPage+1,self=this,term=this.search.val(),context=this.context;if(more.length===0)return;below=more.offset().top-results.offset().top-results.height();if(below<=0){more.addClass("select2-active");this.opts.query({term:term,page:page,context:context,matcher:this.opts.matcher,callback:this.bind(function(data){self.opts.populateResults.call(this,results,data.results,{term:term,page:page,context:context});if(data.more===true){more.detach().appendTo(results.children(":last")).text(self.opts.formatLoadMore(page+1));window.setTimeout(function(){self.loadMoreIfNeeded();},10);}else{more.remove();}
self.positionDropdown();self.resultsPage=page;})});}},updateResults:function(initial){var search=this.search,results=this.results,opts=this.opts,data,self=this;if(initial!==true&&(this.showSearchInput===false||!this.opened())){return;}
search.addClass("select2-active");function postRender(){results.scrollTop(0);search.removeClass("select2-active");self.positionDropdown();}
function render(html){results.html(escapeMarkup(html));postRender();}
if(opts.maximumSelectionSize>=1){data=this.data();if($.isArray(data)&&data.length>=opts.maximumSelectionSize&&checkFormatter(opts.formatSelectionTooBig,"formatSelectionTooBig")){render("<li class='select2-selection-limit'>"+opts.formatSelectionTooBig(opts.maximumSelectionSize)+"</li>");return;}}
if(search.val().length<opts.minimumInputLength&&checkFormatter(opts.formatInputTooShort,"formatInputTooShort")){render("<li class='select2-no-results'>"+opts.formatInputTooShort(search.val(),opts.minimumInputLength)+"</li>");return;}
this.resultsPage=1;opts.query({term:search.val(),page:this.resultsPage,context:null,matcher:opts.matcher,callback:this.bind(function(data){var def;this.context=(data.context===undefined)?null:data.context;if(this.opts.createSearchChoice&&search.val()!==""){def=this.opts.createSearchChoice.call(null,search.val(),data.results);if(def!==undefined&&def!==null&&self.id(def)!==undefined&&self.id(def)!==null){if($(data.results).filter(function(){return equal(self.id(this),self.id(def));}).length===0){data.results.unshift(def);}}}
if(data.results.length===0&&checkFormatter(opts.formatNoMatches,"formatNoMatches")){render("<li class='select2-no-results'>"+opts.formatNoMatches(search.val())+"</li>");return;}
results.empty();self.opts.populateResults.call(this,results,data.results,{term:search.val(),page:this.resultsPage,context:null});if(data.more===true&&checkFormatter(opts.formatLoadMore,"formatLoadMore")){results.children().filter(":last").append("<li class='select2-more-results'>"+escapeMarkup(opts.formatLoadMore(this.resultsPage))+"</li>");window.setTimeout(function(){self.loadMoreIfNeeded();},10);}
this.postprocessResults(data,initial);postRender();})});},cancel:function(){this.close();},blur:function(){this.close();this.container.removeClass("select2-container-active");this.dropdown.removeClass("select2-drop-active");if(this.search[0]===document.activeElement){this.search.blur();}
this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");},focusSearch:function(){window.setTimeout(this.bind(function(){this.search.focus();this.search.val(this.search.val());}),10);},selectHighlighted:function(){var index=this.highlight(),highlighted=this.results.find(".select2-highlighted").not(".select2-disabled"),data=highlighted.closest('.select2-result-selectable').data("select2-data");if(data){highlighted.addClass("select2-disabled");this.highlight(index);this.onSelect(data);}},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder;},initContainerWidth:function(){function resolveContainerWidth(){var style,attrs,matches,i,l;if(this.opts.width==="off"){return null;}else if(this.opts.width==="element"){return this.opts.element.outerWidth()===0?'auto':this.opts.element.outerWidth()+'px';}else if(this.opts.width==="copy"||this.opts.width==="resolve"){style=this.opts.element.attr('style');if(style!==undefined){attrs=style.split(';');for(i=0,l=attrs.length;i<l;i=i+1){matches=attrs[i].replace(/\s/g,'').match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(matches!==null&&matches.length>=1)
return matches[1];}}
if(this.opts.width==="resolve"){style=this.opts.element.css('width');if(style.indexOf("%")>0)return style;return(this.opts.element.outerWidth()===0?'auto':this.opts.element.outerWidth()+'px');}
return null;}else if($.isFunction(this.opts.width)){return this.opts.width();}else{return this.opts.width;}};var width=resolveContainerWidth.call(this);if(width!==null){this.container.attr("style","width: "+width);}}});SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$("<div></div>",{"class":"select2-container"}).html(["    <a href='javascript:void(0)' class='select2-choice'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","    <div class='select2-drop select2-offscreen'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container;},opening:function(){this.search.show();this.parent.opening.apply(this,arguments);this.dropdown.removeClass("select2-offscreen");},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show();},focus:function(){this.close();this.selection.focus();},isFocused:function(){return this.selection[0]===document.activeElement;},cancel:function(){this.parent.cancel.apply(this,arguments);this.selection.focus();},initContainer:function(){var selection,container=this.container,dropdown=this.dropdown,clickingInside=false;this.selection=selection=container.find(".select2-choice");this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);return;}
if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.TAB:case KEY.ENTER:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}else{if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.ESC){return;}
this.open();if(e.which===KEY.ENTER){return;}}}));this.search.bind("focus",this.bind(function(){this.selection.attr("tabIndex","-1");}));this.search.bind("blur",this.bind(function(){if(!this.opened())this.container.removeClass("select2-container-active");window.setTimeout(this.bind(function(){this.selection.attr("tabIndex",this.opts.element.attr("tabIndex"));}),10);}));selection.bind("mousedown",this.bind(function(e){clickingInside=true;if(this.opened()){this.close();this.selection.focus();}else if(this.enabled){this.open();}
killEvent(e);clickingInside=false;}));dropdown.bind("mousedown",this.bind(function(){this.search.focus();}));selection.bind("focus",this.bind(function(){this.container.addClass("select2-container-active");this.search.attr("tabIndex","-1");}));selection.bind("blur",this.bind(function(){this.container.removeClass("select2-container-active");window.setTimeout(this.bind(function(){this.search.attr("tabIndex",this.opts.element.attr("tabIndex"));}),10);}));selection.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);return;}
if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.ESC){return;}
this.open();if(e.which===KEY.ENTER){killEvent(e);return;}
if(e.which<48){killEvent(e);return;}
var keyWritten=String.fromCharCode(e.which).toLowerCase();if(e.shiftKey){keyWritten=keyWritten.toUpperCase();}
this.search.val(keyWritten);killEvent(e);}));selection.delegate("abbr","mousedown",this.bind(function(e){if(!this.enabled)return;this.clear();killEvent(e);this.close();this.triggerChange();this.selection.focus();}));this.setPlaceholder();this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active");}));},clear:function(){this.opts.element.val("");this.selection.find("span").empty();this.selection.removeData("select2-data");this.setPlaceholder();},initSelection:function(){var selected;if(this.opts.element.val()===""){this.close();this.setPlaceholder();}else{var self=this;this.opts.initSelection.call(null,this.opts.element,function(selected){if(selected!==undefined&&selected!==null){self.updateSelection(selected);self.close();self.setPlaceholder();}});}},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var selected=element.find(":selected");if($.isFunction(callback))
callback({id:selected.attr("value"),text:selected.text()});};}
return opts;},setPlaceholder:function(){var placeholder=this.getPlaceholder();if(this.opts.element.val()===""&&placeholder!==undefined){if(this.select&&this.select.find("option:first").text()!=="")return;this.selection.find("span").html(escapeMarkup(placeholder));this.selection.addClass("select2-default");this.selection.find("abbr").hide();}},postprocessResults:function(data,initial){var selected=0,self=this,showSearchInput=true;this.results.find(".select2-result-selectable").each2(function(i,elm){if(equal(self.id(elm.data("select2-data")),self.opts.element.val())){selected=i;return false;}});this.highlight(selected);if(initial===true){showSearchInput=this.showSearchInput=data.results.length>=this.opts.minimumResultsForSearch;this.dropdown.find(".select2-search")[showSearchInput?"removeClass":"addClass"]("select2-search-hidden");$(this.dropdown,this.container)[showSearchInput?"addClass":"removeClass"]("select2-with-searchbox");}},onSelect:function(data){var old=this.opts.element.val();this.opts.element.val(this.id(data));this.updateSelection(data);this.close();this.selection.focus();if(!equal(old,this.id(data))){this.triggerChange();}},updateSelection:function(data){var container=this.selection.find("span"),formatted;this.selection.data("select2-data",data);container.empty();formatted=this.opts.formatSelection(data,container);if(formatted!==undefined){container.append(escapeMarkup(formatted));}
this.selection.removeClass("select2-default");if(this.opts.allowClear&&this.getPlaceholder()!==undefined){this.selection.find("abbr").show();}},val:function(){var val,data=null,self=this;if(arguments.length===0){return this.opts.element.val();}
val=arguments[0];if(this.select){this.select.val(val).find(":selected").each2(function(i,elm){data={id:elm.attr("value"),text:elm.text()};return false;});this.updateSelection(data);this.setPlaceholder();}else{if(this.opts.initSelection===undefined){throw new Error("cannot call val() if initSelection() is not defined");}
if(!val){this.clear();return;}
this.opts.initSelection(this.opts.element,function(data){self.opts.element.val(!data?"":self.id(data));self.updateSelection(data);self.setPlaceholder();});}},clearSearch:function(){this.search.val("");},data:function(value){var data;if(arguments.length===0){data=this.selection.data("select2-data");if(data==undefined)data=null;return data;}else{if(!value||value===""){this.clear();}else{this.opts.element.val(!value?"":this.id(value));this.updateSelection(value);}}}});MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$("<div></div>",{"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' style='width: 25px;' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container;},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var data=[];element.find(":selected").each2(function(i,elm){data.push({id:elm.attr("value"),text:elm.text()});});if($.isFunction(callback))
callback(data);};}
return opts;},initContainer:function(){var selector=".select2-choices",selection;this.searchContainer=this.container.find(".select2-search-field");this.selection=selection=this.container.find(selector);this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.BACKSPACE&&this.search.val()===""){this.close();var choices,selected=selection.find(".select2-search-choice-focus");if(selected.length>0){this.unselect(selected.first());this.search.width(10);killEvent(e);return;}
choices=selection.find(".select2-search-choice");if(choices.length>0){choices.last().addClass("select2-search-choice-focus");}}else{selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");}
if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.ENTER:case KEY.TAB:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}
if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.BACKSPACE||e.which===KEY.ESC){return;}
this.open();if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);}}));this.search.bind("keyup",this.bind(this.resizeSearch));this.search.bind("blur",this.bind(function(){this.container.removeClass("select2-container-active");}));this.container.delegate(selector,"mousedown",this.bind(function(e){if(!this.enabled)return;this.clearPlaceholder();this.open();this.focusSearch();e.preventDefault();}));this.container.delegate(selector,"focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder();}));this.clearSearch();},enable:function(){if(this.enabled)return;this.parent.enable.apply(this,arguments);this.search.removeAttr("disabled");},disable:function(){if(!this.enabled)return;this.parent.disable.apply(this,arguments);this.search.attr("disabled",true);},initSelection:function(){var data;if(this.opts.element.val()===""){this.updateSelection([]);this.close();this.clearSearch();}
if(this.select||this.opts.element.val()!==""){var self=this;this.opts.initSelection.call(null,this.opts.element,function(data){if(data!==undefined&&data!==null){self.updateSelection(data);self.close();self.clearSearch();}});}},clearSearch:function(){var placeholder=this.getPlaceholder();if(placeholder!==undefined&&this.getVal().length===0&&this.search.hasClass("select2-focused")===false){this.search.val(placeholder).addClass("select2-default");this.resizeSearch();}else{this.search.val(" ").width(10);}},clearPlaceholder:function(){if(this.search.hasClass("select2-default")){this.search.val("").removeClass("select2-default");}else{if(this.search.val()===" ")this.search.val("");}},opening:function(){this.parent.opening.apply(this,arguments);this.clearPlaceholder();this.resizeSearch();this.focusSearch();},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);},focus:function(){this.close();this.search.focus();},isFocused:function(){return this.search.hasClass("select2-focused");},updateSelection:function(data){var ids=[],filtered=[],self=this;$(data).each(function(){if(indexOf(self.id(this),ids)<0){ids.push(self.id(this));filtered.push(this);}});data=filtered;this.selection.find(".select2-search-choice").remove();$(data).each(function(){self.addSelectedChoice(this);});self.postprocessResults();},onSelect:function(data){this.addSelectedChoice(data);if(this.select){this.postprocessResults();}
if(this.opts.closeOnSelect){this.close();this.search.width(10);}else{this.search.width(10);this.resizeSearch();if(this.countSelectableResults()>0){this.positionDropdown();}else{this.close();}}
this.triggerChange({added:data});this.focusSearch();},cancel:function(){this.close();this.focusSearch();},addSelectedChoice:function(data){var choice=$("<li class='select2-search-choice'>"+"    <div></div>"+"    <a href='javascript:void(0)' class='select2-search-choice-close' tabindex='-1'></a>"+"</li>"),id=this.id(data),val=this.getVal(),formatted;formatted=this.opts.formatSelection(data,choice);choice.find("div").replaceWith("<div>"+escapeMarkup(formatted)+"</div>");choice.find(".select2-search-choice-close").bind("click dblclick",this.bind(function(e){if(!this.enabled)return;$(e.target).closest(".select2-search-choice").fadeOut('fast').animate({width:"hide"},50,this.bind(function(){this.unselect($(e.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");this.close();this.focusSearch();})).dequeue();killEvent(e);})).bind("focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");}));choice.data("select2-data",data);choice.insertBefore(this.searchContainer);val.push(id);this.setVal(val);},unselect:function(selected){var val=this.getVal(),data,index;selected=selected.closest(".select2-search-choice");if(selected.length===0){throw"Invalid argument: "+selected+". Must be .select2-search-choice";}
data=selected.data("select2-data");index=indexOf(this.id(data),val);if(index>=0){val.splice(index,1);this.setVal(val);if(this.select)this.postprocessResults();}
selected.remove();this.triggerChange({removed:data});},postprocessResults:function(){var val=this.getVal(),choices=this.results.find(".select2-result-selectable"),compound=this.results.find(".select2-result-with-children"),self=this;choices.each2(function(i,choice){var id=self.id(choice.data("select2-data"));if(indexOf(id,val)>=0){choice.addClass("select2-disabled").removeClass("select2-result-selectable");}else{choice.removeClass("select2-disabled").addClass("select2-result-selectable");}});compound.each2(function(i,e){if(e.find(".select2-result-selectable").length==0){e.addClass("select2-disabled");}else{e.removeClass("select2-disabled");}});choices.each2(function(i,choice){if(!choice.hasClass("select2-disabled")&&choice.hasClass("select2-result-selectable")){self.highlight(0);return false;}});},resizeSearch:function(){var minimumWidth,left,maxWidth,containerLeft,searchWidth,sideBorderPadding=getSideBorderPadding(this.search);minimumWidth=measureTextWidth(this.search)+10;left=this.search.offset().left;maxWidth=this.selection.width();containerLeft=this.selection.offset().left;searchWidth=maxWidth-(left-containerLeft)-sideBorderPadding;if(searchWidth<minimumWidth){searchWidth=maxWidth-sideBorderPadding;}
if(searchWidth<40){searchWidth=maxWidth-sideBorderPadding;}
this.search.width(searchWidth);},getVal:function(){var val;if(this.select){val=this.select.val();return val===null?[]:val;}else{val=this.opts.element.val();return splitVal(val,this.opts.separator);}},setVal:function(val){var unique;if(this.select){this.select.val(val);}else{unique=[];$(val).each(function(){if(indexOf(this,unique)<0)unique.push(this);});this.opts.element.val(unique.length===0?"":unique.join(this.opts.separator));}},val:function(){var val,data=[],self=this;if(arguments.length===0){return this.getVal();}
val=arguments[0];if(!val){this.opts.element.val("");this.updateSelection([]);this.clearSearch();return;}
this.setVal(val);if(this.select){this.select.find(":selected").each(function(){data.push({id:$(this).attr("value"),text:$(this).text()});});this.updateSelection(data);}else{if(this.opts.initSelection===undefined){throw new Error("val() cannot be called if initSelection() is not defined")}
this.opts.initSelection(this.opts.element,function(data){var ids=$(data).map(self.id);self.setVal(ids);self.updateSelection(data);self.clearSearch();});}
this.clearSearch();},onSortStart:function(){if(this.select){throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");}
this.search.width(0);this.searchContainer.hide();},onSortEnd:function(){var val=[],self=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){val.push(self.opts.id($(this).data("select2-data")));});this.setVal(val);this.triggerChange();},data:function(values){var self=this,ids;if(arguments.length===0){return this.selection.find(".select2-search-choice").map(function(){return $(this).data("select2-data");}).get();}else{if(!values){values=[];}
ids=$.map(values,function(e){return self.opts.id(e)});this.setVal(ids);this.updateSelection(values);this.clearSearch();}}});$.fn.select2=function(){var args=Array.prototype.slice.call(arguments,0),opts,select2,value,multiple,allowedMethods=["val","destroy","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];this.each(function(){if(args.length===0||typeof(args[0])==="object"){opts=args.length===0?{}:$.extend({},args[0]);opts.element=$(this);if(opts.element.get(0).tagName.toLowerCase()==="select"){multiple=opts.element.attr("multiple");}else{multiple=opts.multiple||false;if("tags"in opts){opts.multiple=multiple=true;}}
select2=multiple?new MultiSelect2():new SingleSelect2();select2.init(opts);}else if(typeof(args[0])==="string"){if(indexOf(args[0],allowedMethods)<0){throw"Unknown method: "+args[0];}
value=undefined;select2=$(this).data("select2");if(select2===undefined)return;if(args[0]==="container"){value=select2.container;}else{value=select2[args[0]].apply(select2,args.slice(1));}
if(value!==undefined){return false;}}else{throw"Invalid arguments to select2 plugin: "+args;}});return(value===undefined)?this:value;};$.fn.select2.defaults={width:"copy",closeOnSelect:true,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(result,container,query){var markup=[];markMatch(result.text,query.term,markup);return markup.join("");},formatSelection:function(data,container){return data.text;},formatNoMatches:function(){return"No matches found";},formatInputTooShort:function(input,min){return"Please enter "+(min-input.length)+" more characters";},formatSelectionTooBig:function(limit){return"You can only select "+limit+" items";},formatLoadMore:function(pageNumber){return"Loading more results...";},minimumResultsForSearch:0,minimumInputLength:0,maximumSelectionSize:0,id:function(e){return e.id;},matcher:function(term,text){return text.toUpperCase().indexOf(term.toUpperCase())>=0;}};window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch},"class":{"abstract":AbstractSelect2,"single":SingleSelect2,"multi":MultiSelect2}};}(jQuery));