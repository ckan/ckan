this.ckan.module('custom-fields',function(jQuery,_){return{options:{fieldSelector:'.control-custom'},initialize:function(){if(!jQuery.browser.msie||!jQuery.browser.version=='7.0'){jQuery.proxyAll(this,/_on/);var delegated=this.options.fieldSelector+':last input:first';this.el.on('change',delegated,this._onChange);this.el.on('change',':checkbox',this._onRemove);this.$('.checkbox').addClass("btn btn-danger icon-remove");}},newField:function(element){this.el.append(this.cloneField(element));},cloneField:function(current){return this.resetField(jQuery(current).clone());},resetField:function(field){function increment(index,string){return(string||'').replace(/\d+/,function(int){return 1+parseInt(int,10);});}
var input=field.find(':input');input.val('').attr('id',increment).attr('name',increment);var label=field.find('label');label.text(increment).attr('for',increment);return field;},disableField:function(field,disable){field.toggleClass('disabled',disable!==false);field.find(':input:not(:checkbox)').prop('disabled',disable!==false);},_onChange:function(event){if(event.target.value!==''){var parent=jQuery(event.target).parents('.control-custom');this.newField(parent);}},_onRemove:function(event){var parent=jQuery(event.target).parents('.control-custom');this.disableField(parent,event.target.checked);}};});