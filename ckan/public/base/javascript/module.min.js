this.ckan=this.ckan||{};(function(ckan,jQuery,window){var MODULE_PREFIX='data-module';var MODULE_OPTION_PREFIX='data-module-';function BaseModule(el,options,sandbox){this.el=el instanceof jQuery?el:jQuery(el);this.options=jQuery.extend(true,{},this.options,options);this.sandbox=sandbox;}
jQuery.extend(BaseModule.prototype,{el:null,options:null,$:function(selector){return this.el.find(selector);},i18n:function(key){var args=[].slice.call(arguments,1);var i18n=this.options.i18n;var trans=(i18n&&i18n[key])||key;if(typeof trans==='function'){trans=trans.apply(null,args);}
return typeof trans.fetch==='function'?trans.fetch.apply(trans,args):trans;},initialize:function(){},teardown:function(){},remove:function(){this.teardown();this.el.remove();}});function module(name,properties){if(module.registry[name]){throw new Error('There is already a module registered as "'+name+'"');}
if(typeof properties==='function'){properties=properties(jQuery,ckan.i18n.translate,ckan.i18n);}
properties=jQuery.extend({constructor:function Module(){BaseModule.apply(this,arguments);}},properties);module.registry[name]=jQuery.inherit(BaseModule,properties,{namespace:name});return ckan;}
module.registry={};module.instances={};module.initialize=function(){ckan.pubsub.enqueue();jQuery('[data-module]',document.body).each(function(index,element){module.initializeElement(this);});ckan.pubsub.dequeue();return module;};module.initializeElement=function(element){var registry=module.registry;var names=jQuery.trim(element.getAttribute(MODULE_PREFIX)).split(' ');jQuery.each(names,function(index,name){var Module=registry[name];if(Module&&typeof Module==='function'){module.createInstance(Module,element);}});};module.createInstance=function(Module,element){var options=module.extractOptions(element);var sandbox=ckan.sandbox(element,options);var instance=new Module(element,options,sandbox);if(typeof instance.initialize==='function'){instance.initialize();}
var instances=module.instances[Module.namespace]||[];instances.push(instance);module.instances[Module.namespace]=instances;};module.extractOptions=function(element){var attrs=element.attributes;var index=0;var length=attrs.length;var options={};var prop;var attr;var value;for(;index<length;index+=1){attr=attrs[index];if(attr.name.indexOf(MODULE_OPTION_PREFIX)===0){prop=attr.name.slice(MODULE_OPTION_PREFIX.length);try{value=attr.value===""?true:jQuery.parseJSON(attr.value);}catch(error){value=attr.value;}
options[jQuery.camelCase(prop)]=value;}}
return options;};ckan.module=module;ckan.module.BaseModule=BaseModule;})(this.ckan,this.jQuery,this);